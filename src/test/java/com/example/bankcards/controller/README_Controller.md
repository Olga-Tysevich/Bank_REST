# Тесты контроллеров (UI/Integration)

Модуль содержит интеграционные UI-тесты REST API приложения `bankcards`, написанные с использованием **RestAssured**, **Spring Boot Test** и **TestContainers**.

---

## Назначение

Тесты обеспечивают автоматическую проверку работы REST-контроллеров, включая:

- Авторизацию пользователей
- Корректность HTTP-статусов (`200`, `400`, `401`, `404` и др.)
- Соответствие JSON-ответов предопределённым схемам (JSON Schema)
- Проверку времени отклика (таймауты)
- Тестирование в окружении с изолированными контейнерами PostgreSQL и Redis (Testcontainers)

---

## Структура

### `BaseTest`

Базовый класс для всех UI/интеграционных тестов:

- Запускает тестовые контейнеры PostgreSQL и Redis
- Устанавливает переменные окружения через `DotenvLoader`
- Проверяет доступность Redis через Lettuce
- Предоставляет методы для установки и очистки авторизации (`SecurityContextHolder`)

### `RestBaseTest`

Наследуется от `RestBaseTest`, добавляя функциональность для HTTP-запросов:

- `checkStatusCodeAndBodyInPostRequest(...)`
- `checkStatusCodeAndBodyInDeleteRequest(...)`
- `checkStatusCodeAndBodyInGetRequest(...)`
- Получение `accessToken` по валидным данным пользователя

### `AuthControllerTest`

Тестирует функциональность авторизации:

- Успешный логин
- Обработка неверных данных
- Работа с недействительными токенами
- Блокировка доступа

---

## Используемые технологии

- Java 17+
- Spring Boot Test – интеграционное тестирование с подъемом контекста
- JUnit 5
- RestAssured – DSL для REST API тестов
- Hamcrest – матчер-библиотека
- JsonSchemaValidator – проверка JSON-схем
- Testcontainers – контейнеры PostgreSQL и Redis
- Lettuce – клиент для Redis

---

## Что проверяют тесты

- Успешный логин и получение JWT токена
- Работа API с валидным и невалидным токеном
- Точность схемы JSON-ответа
- Корректность и стабильность эндпоинтов
- Работа с query-параметрами (например, `userId`)
- Время отклика API (в пределах `DEFAULT_TIMEOUT`)

---

## Как запускать тесты

Убедитесь, что установлены **Docker** и **JDK 17+**, затем выполните:

### Gradle
```bash
mvn test
