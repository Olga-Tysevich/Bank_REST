# Тесты сервисов

Юнит- и интеграционные тесты бизнес-логики с использованием моков, встроенного Spring-контекста и `Testcontainers`.

## Описание

В данном разделе представлены тесты для проверки ключевой бизнес-логики приложения **BankCards**. Тесты написаны с использованием **JUnit 5**, **Spring Boot Test**, и **Testcontainers**, с упором на проверку граничных состояний, правил безопасности и корректности выполнения бизнес-процессов.

### Структура тестов

Все тесты, работающие с инфраструктурой (БД, Redis), наследуются от абстрактного базового класса `BaseTest`, который:

- Инициализирует контейнеры PostgreSQL и Redis;
- Настраивает переменные окружения (в том числе для `Liquibase`);
- Проверяет доступность Redis через Lettuce (ping);
- Устанавливает и сбрасывает аутентификацию пользователя через `SecurityContextHolder`.

**Примеры тестов:**

- **AuthServiceImplTest**
    - Успешный вход по email и паролю.
    - Ошибка при попытке входа с неверным паролем.

- **TransferServiceImplTransferOnlyBetweenYourCardsTrueTest**
    - Переводы разрешены только между своими картами.
    - Проверка:
        - Перевода между своими картами.
        - Ошибки при попытке перевода на чужую карту.
        - Ошибки при недостаточном балансе, заблокированных картах, переводе на ту же карту и т.д.

- **TransferServiceImplTransferOnlyBetweenYourCardsFalseTest**
    - Переводы между картами разных пользователей разрешены.
    - Проверка успешного перевода и корректного обновления баланса после обработки очереди.

### Используемые технологии

- `JUnit 5`
- `Spring Boot Test`
- `AssertJ`
- `Testcontainers` (PostgreSQL + Redis)
- `Lettuce` (клиент Redis)
- `@DynamicPropertySource` и `@TestPropertySource` для изоляции конфигурации
- `.env.test` для загрузки тестовых переменных окружения

### Как запустить тесты

Если вы используете **Maven**, выполните в корне проекта:

```bash
mvn test
