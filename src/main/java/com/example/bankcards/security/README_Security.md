# Безопасность

- Этот модуль предоставляет компоненты для обеспечения безопасности в приложении, включая обработку 
  аутентификации через JWT (JSON Web Token), обработку ошибок доступа и управление доступом.

## Содержимое модуля

В модуле безопасности находятся следующие основные классы:

1. **JwtAuthFilter**  
   Фильтр для обработки аутентификации пользователей через JWT.
    - Проверяет наличие и валидность JWT токена в заголовке `Authorization` запроса.
    - Извлекает пользователя по токену и устанавливает контекст безопасности в системе.
    - Если токен отсутствует или недействителен, возвращается ошибка `401 Unauthorized`.

2. **ApiAccessDeniedHandler**  
   Обработчик ошибок доступа, возвращающий сообщение об ошибке при попытке доступа к защищенному ресурсу без соответствующих прав.
    - Генерирует ответ с кодом ошибки `403 Forbidden` в формате JSON, который включает заголовок и подробное описание ошибки.

3. **ForbiddenEntryPoint**  
   Обработчик входа для неавторизованных пользователей, перенаправляющий их на страницу с ошибкой при попытке доступа к защищенным ресурсам без аутентификации.
    - Генерирует ответ с кодом ошибки `401 Unauthorized` и сообщение о том, что пользователь не авторизован.

## Как работает модуль

1. **JWT аутентификация**  
   При каждом запросе к защищенному ресурсу фильтр `JwtAuthFilter` проверяет, есть ли в заголовке запроса валидный JWT токен. Если токен действителен, извлекается имя пользователя, и система проверяет, был ли пользователь аутентифицирован. Если аутентификация проходит успешно, пользователь получает доступ к ресурсу.

2. **Обработка ошибок доступа**  
   Если пользователь пытается получить доступ к защищенному ресурсу без соответствующих прав, класс `ApiAccessDeniedHandler` генерирует ошибку с кодом `403 Forbidden` и подробным сообщением, объясняющим причину отказа в доступе.

3. **Обработка неавторизованных запросов**  
   Если пользователь пытается получить доступ к защищенному ресурсу без предоставления действительного токена, класс `ForbiddenEntryPoint` генерирует ошибку с кодом `401 Unauthorized` и сообщение о том, что пользователь не авторизован.

## Пример работы

1. **JWT токен** должен быть передан в заголовке `Authorization` запроса, начиная с префикса `Bearer`.
2. При каждом запросе фильтр будет проверять токен, а если он действителен, установит аутентификацию пользователя в контексте безопасности.
3. В случае ошибки, например, если токен недействителен или отсутствует, система вернет код ошибки и описание проблемы в формате JSON.

## Конфигурация

- Все игнорируемые URL-адреса могут быть настроены в конфигурации через параметр `spring.app.web.ignoredUrls`, чтобы пропустить фильтрацию для определенных путей.
  
