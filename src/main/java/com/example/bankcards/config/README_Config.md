# Конфигурация
# Модуль `config`

- содержит конфигурационные классы, которые настраивают различные компоненты Spring-приложения, такие как безопасность, Redis и логирование. 
 В этом модуле находятся классы, которые обеспечивают интеграцию с Redis, конфигурацию безопасности и настройку логирования через аспектно-ориентированное
 программирование.

## Основные компоненты модуля

### 1. Конфигурация безопасности (`WebSecurityConfig`)

- **Основная цель**: Конфигурирует настройки безопасности для приложения.
- **Особенности**:
    - Настроена аутентификация и авторизация с использованием JWT.
    - Конфигурируется **CORS** (Cross-Origin Resource Sharing) для разрешения определённых источников, методов и заголовков.
    - Обрабатываются ошибки доступа с помощью кастомных обработчиков:
        - `ApiAccessDeniedHandler` — обработчик отказа в доступе.
        - `ForbiddenEntryPoint` — обработчик неавторизованных запросов.
    - Настроены игнорируемые URL, которые не требуют аутентификации.

### 2. Конфигурация Redis (`RedisConfig`)

- **Основная цель**: Содержит настройки для работы с Redis как с кэшем и для сериализации сообщений.
- **Особенности**:
    - Настроен `RedisTemplate` для сериализации объектов типа `TransferMessage` в **JSON** с использованием кастомного сериализатора.
    - Применяется поддержка работы с типами данных Java 8, такими как даты и время.
    - Конфигурируется `RedisCacheManager` для управления кэшированием с использованием JSON-сериализации значений кэша.

### 3. Логирование с использованием аспектов (`LoggerAspect`)

- **Основная цель**: Настроено логирование с использованием аспектно-ориентированного программирования (AOP).
- **Особенности**:
    - Логируются все вызовы методов в компонентах с аннотациями `@RestController`, `@Service`, `@Repository`.
    - Для каждого метода создаются записи:
        - Входные параметры метода.
        - Результат выполнения метода.
        - Исключения, если они возникли.
    - Логи выводятся с уровня **`DEBUG`** (для нормальных операций) и **`ERROR`** (для исключений), что помогает в отладке и мониторинге работы приложения.

### 4. Конфигурация приложения в целом (`AppConfig`)

- **Основная цель**: Содержит общие настройки для работы приложения.

### 5. Аннотация для запрета отмены трансфера и ее проверка (`DenyCancelTransfer`, `TransferCancelAspect`)

- **Основная цель**: Запретить отменять переводы откуда попало.
- **Особенности**:
    - В TransferCancelAspect задается сет разрешенных классов, способных вызвать отмену.
    - Аннотацией DenyCancelTransfer помечается метод отмены трансфера.

## Как работает

### 1. Безопасность

- Все запросы, требующие аутентификации, обрабатываются с использованием **JWT-токенов**.
- Приложение настроено на работу без сессий с использованием политики **`STATELESS`**.
- **CORS** настроен для разрешения только определённых источников, методов и заголовков, что помогает интеграции с фронтендом и сторонними сервисами.

### 2. Redis

- Redis используется для **кэширования** данных, что ускоряет доступ к данным и уменьшает нагрузку на сервер базы данных.
- Объекты типа `TransferMessage` сериализуются в **JSON** с помощью настроенного `ObjectMapper`, который поддерживает работу с Java 8 типами данных (например, даты и время).
- **RedisCacheManager** управляет кэшированием, используя эти настройки сериализации для значений.

### 3. Логирование

- Весь процесс выполнения методов (входные параметры, результаты и исключения) логируется с использованием **AOP**.
- Это позволяет отслеживать, какие методы были вызваны, с какими параметрами и результатами, а также логировать исключения для упрощения отладки и мониторинга.

### 4. Аннотация для запрета отмены трансфера и ее проверка (`DenyCancelTransfer`, `TransferCancelAspect`)

- Аннотацией DenyCancelTransfer помечается метод отмены.
- TransferCancelAspect перехватывает методы, аннотированные @DenyCancelTransfer, гарантируя, что только методы, вызванные из определенных разрешенных 
  классов (например, TransferQueueProcessor и TransferServiceImpl), могут быть продолжены. При вызове из любого другого класса он выдает IllegalAccessException,
  запрещая операцию отмены.

---

Эти компоненты и конфигурации обеспечивают:

- **Безопасность** с использованием JWT.
- **Производительность** за счет кэширования с Redis.
- **Мониторинг** с помощью логирования и AOP.
- **Гибкую настройку** с помощью возможностей спринга, через application.yml.
